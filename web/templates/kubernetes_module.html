{{define "title"}}{{.Module.Title}} - Kubernetes Course - LeetCode Clone{{end}}
{{define "content"}}
<div class="container">
    <div class="module-header">
        <div>
            <a href="/kubernetes" class="back-link">← Back to Kubernetes Course</a>
            <h2 style="margin-top: 10px;">{{.Module.Title}}</h2>
            <p class="module-description">{{.Module.Description}}</p>
        </div>
    </div>

    <div class="module-content">
        <div class="lessons-section">
            <h3>Lessons</h3>
            {{range $index, $lesson := .Module.Lessons}}
            <div class="lesson-card">
                <div class="lesson-header" onclick="toggleLesson({{$index}})">
                    <h4>{{$lesson.Title}}</h4>
                    <span class="lesson-toggle" id="toggle-{{$index}}">▼</span>
                </div>
                <div class="lesson-content" id="lesson-{{$index}}" style="display: none;">
                    <div class="lesson-text">{{markdown $lesson.Content}}</div>
                    {{if $lesson.CodeExamples}}
                    <div class="lesson-code">
                        <pre><code class="language-yaml">{{$lesson.CodeExamples}}</code></pre>
                    </div>
                    {{end}}
                </div>
            </div>
            {{end}}
        </div>

        <div class="problems-section">
            <h3>Practice Problems</h3>
            {{if .Problems}}
            <ul class="problem-list">
                {{range .Problems}}
                <li>
                    <a href="/problem/{{.ID}}">
                        <span class="problem-id">#{{.ID}}</span>
                        <span class="problem-title">{{.Title}}</span>
                        <span class="difficulty difficulty-{{.Difficulty}}">{{.Difficulty}}</span>
                        <span class="problem-topic">{{.Topic}}</span>
                    </a>
                </li>
                {{end}}
            </ul>
            {{else}}
            <p class="module-description">No practice problems available yet.</p>
            {{end}}
        </div>
    </div>
</div>

<style>
.module-header {
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 1px solid #444;
}

.module-content {
    display: grid;
    grid-template-columns: 1fr;
    gap: 30px;
}

.lessons-section h3,
.problems-section h3 {
    color: var(--text-primary);
    margin-bottom: 20px;
    font-size: 1.3em;
}

.lesson-card {
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    margin-bottom: 15px;
    overflow: hidden;
}

.lesson-header {
    padding: 15px 20px;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: var(--bg-tertiary);
    transition: background 0.2s;
}

.lesson-header:hover {
    background: var(--bg-tertiary);
}

.lesson-header h4 {
    margin: 0;
    color: var(--text-primary);
    font-size: 1.1em;
}

.lesson-toggle {
    color: var(--accent-color);
    font-size: 0.9em;
    transition: transform 0.3s;
}

.lesson-content {
    padding: 20px;
}

.lesson-text {
    color: var(--text-primary);
    line-height: 1.6;
    margin-bottom: 20px;
}

.lesson-text h1, .lesson-text h2, .lesson-text h3 {
    color: var(--text-primary);
    margin-top: 20px;
    margin-bottom: 10px;
}

.lesson-text ul,
.lesson-text ol {
    margin: 10px 0;
    padding-left: 30px;
}

.lesson-text li {
    margin: 5px 0;
}

.lesson-text p {
    margin: 10px 0;
}

.lesson-text strong {
    color: var(--text-primary);
    font-weight: bold;
}

.lesson-text code {
    background: var(--bg-card);
    padding: 2px 6px;
    border-radius: 3px;
    color: var(--code-text);
    font-family: 'Courier New', monospace;
}

.lesson-code {
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: 6px;
    padding: 15px;
    margin-top: 15px;
    overflow-x: auto;
}

.lesson-code pre {
    margin: 0;
    font-family: 'Courier New', monospace;
    font-size: 0.9em;
    line-height: 1.5;
}

.lesson-code code {
    color: var(--code-text);
    background: transparent;
    padding: 0;
    border-radius: 0;
}

.problem-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.problem-list li {
    margin-bottom: 10px;
}

.problem-list a {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 12px 15px;
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 6px;
    text-decoration: none;
    color: var(--text-primary);
    transition: all 0.2s;
}

.problem-list a:hover {
    background: var(--bg-tertiary);
    border-color: var(--accent-color);
}

.problem-id {
    color: var(--text-muted);
    font-family: monospace;
    min-width: 50px;
}

.problem-title {
    flex: 1;
    color: var(--text-primary);
}

.difficulty {
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 0.85em;
    font-weight: bold;
}

.difficulty-Easy {
    background: var(--success-bg);
    color: white;
}

.difficulty-Medium {
    background: rgba(255, 200, 112, 0.3);
    color: #ffc870;
    border: 1px solid #ffc870;
}

.difficulty-Hard {
    background: #dc3545;
    color: white;
}

.problem-topic {
    color: var(--text-muted);
    font-size: 0.9em;
}
</style>

<script>
function toggleLesson(index) {
    const content = document.getElementById('lesson-' + index);
    const toggle = document.getElementById('toggle-' + index);
    
    if (content.style.display === 'none') {
        content.style.display = 'block';
        toggle.textContent = '▲';
        
        // Highlight code in this lesson
        if (window.highlightCode) {
            setTimeout(() => {
                const codeBlocks = content.querySelectorAll('code');
                codeBlocks.forEach(block => {
                    if (!block.hasAttribute('data-highlighted')) {
                        highlightKubernetesCode(block);
                    }
                });
            }, 100);
        }
    } else {
        content.style.display = 'none';
        toggle.textContent = '▼';
    }
}

function highlightKubernetesCode(block) {
    if (typeof CodeMirror !== 'undefined' && CodeMirror.runMode) {
        var text = block.textContent;
        var lang = 'yaml'; // Default for Kubernetes
        
        // Detect language from content or context
        if (text.includes('kubectl') || text.includes('# ')) {
            lang = 'text/x-sh'; // Bash/shell
        } else if (text.includes('apiVersion:') || text.includes('kind:')) {
            lang = 'yaml';
        }
        
        block.textContent = '';
        try {
            CodeMirror.runMode(text, lang, block);
            block.setAttribute('data-highlighted', 'true');
        } catch (e) {
            block.textContent = text;
            block.setAttribute('data-highlighted', 'true');
        }
    }
}

// Highlight code on page load
document.addEventListener('DOMContentLoaded', function() {
    if (window.highlightCode) {
        window.highlightCode();
    }
});
</script>
{{end}}
{{template "layout.html" .}}
