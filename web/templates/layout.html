<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{block "title" .}}LeetCode Clone{{end}}</title>
    <script>
        // Apply theme immediately to prevent flash
        (function() {
            try {
                const savedTheme = localStorage.getItem('theme') || 'dark';
                document.documentElement.setAttribute('data-theme', savedTheme);
            } catch(e) {
                document.documentElement.setAttribute('data-theme', 'dark');
            }
        })();
    </script>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/monokai.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/go/go.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/python/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/yaml/yaml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/sql/sql.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/json/json.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/runmode/runmode.min.js"></script>
    <link rel="stylesheet" href="/static/style.css">
    <script>
        // Highlight code blocks on page load and after HTMX updates
        function highlightCode() {
            if (typeof CodeMirror !== 'undefined' && CodeMirror.runMode) {
                // Find all code blocks
                var codeBlocks = document.querySelectorAll('.lesson-code code, code[class*="language-"]');
                codeBlocks.forEach(function(block) {
                    if (!block.hasAttribute('data-highlighted')) {
                        var text = block.textContent;
                        var lang = 'python'; // default
                        
                        // Detect language from class
                        if (block.className) {
                            if (block.className.includes('language-go') || block.className.includes('language-golang')) {
                                lang = 'go';
                            } else if (block.className.includes('language-python')) {
                                lang = 'python';
                            } else if (block.className.includes('language-javascript') || block.className.includes('language-js')) {
                                lang = 'javascript';
                            } else if (block.className.includes('language-java')) {
                                lang = 'text/x-java';
                            } else if (block.className.includes('language-cpp') || block.className.includes('language-c++')) {
                                lang = 'text/x-c++src';
                            } else if (block.className.includes('language-c')) {
                                lang = 'text/x-csrc';
                            } else if (block.className.includes('language-sql')) {
                                lang = 'text/x-sql';
                            } else if (block.className.includes('language-bash') || block.className.includes('language-sh')) {
                                lang = 'text/x-sh';
                            } else if (block.className.includes('language-yaml')) {
                                lang = 'yaml';
                            } else if (block.className.includes('language-json')) {
                                lang = 'application/json';
                            } else {
                                // Try to detect from parent context or content
                                var parent = block.closest('.lesson-code');
                                if (parent) {
                                    // Check if we're in a specific course module
                                    var url = window.location.pathname;
                                    if (url.includes('/golang')) {
                                        lang = 'go';
                                    } else if (url.includes('/python')) {
                                        lang = 'python';
                                    } else if (url.includes('/kubernetes')) {
                                        lang = 'yaml'; // Default for Kubernetes (YAML manifests)
                                    } else if (url.includes('/algorithms')) {
                                        lang = 'python'; // Default for algorithms
                                    }
                                }
                            }
                        }
                        
                        block.textContent = '';
                        try {
                            CodeMirror.runMode(text, lang, block);
                            block.setAttribute('data-highlighted', 'true');
                        } catch (e) {
                            // If language not supported, just display as plain text
                            block.textContent = text;
                            block.setAttribute('data-highlighted', 'true');
                        }
                    }
                });
            }
        }
        document.addEventListener('DOMContentLoaded', highlightCode);
        if (document.body) {
            document.body.addEventListener('htmx:afterSwap', highlightCode);
        }
        // Also highlight when lessons are toggled
        window.highlightCode = highlightCode;

        // Theme toggle functionality
        (function() {
            'use strict';
            
            function applyTheme(theme) {
                const html = document.documentElement;
                html.setAttribute('data-theme', theme);
                try {
                    localStorage.setItem('theme', theme);
                } catch(e) {}
                
                const toggle = document.getElementById('theme-toggle-switch');
                if (toggle) {
                    toggle.checked = (theme === 'light');
                }
                
                // Update CodeMirror
                if (typeof CodeMirror !== 'undefined') {
                    setTimeout(function() {
                        document.querySelectorAll('.CodeMirror').forEach(function(el) {
                            try {
                                const cm = el.CodeMirror;
                                if (cm) {
                                    cm.setOption('theme', theme === 'light' ? 'default' : 'monokai');
                                }
                            } catch(e) {}
                        });
                    }, 50);
                }
            }
            
            function initTheme() {
                const toggle = document.getElementById('theme-toggle-switch');
                if (!toggle) {
                    setTimeout(initTheme, 50);
                    return;
                }
                
                const savedTheme = (function() {
                    try {
                        return localStorage.getItem('theme') || 'dark';
                    } catch(e) {
                        return 'dark';
                    }
                })();
                
                applyTheme(savedTheme);
                
                toggle.addEventListener('change', function() {
                    applyTheme(this.checked ? 'light' : 'dark');
                });
            }
            
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initTheme);
            } else {
                initTheme();
            }
        })();

        // Mobile menu functionality
        (function() {
            'use strict';
            
            function initMobileMenu() {
                const toggle = document.getElementById('mobile-menu-toggle');
                const mobileNav = document.getElementById('mobile-nav');
                const overlay = document.getElementById('mobile-overlay');
                const mobileThemeToggle = document.getElementById('theme-toggle-switch-mobile');
                const desktopThemeToggle = document.getElementById('theme-toggle-switch');
                
                if (!toggle || !mobileNav || !overlay) {
                    setTimeout(initMobileMenu, 50);
                    return;
                }
                
                function openMenu() {
                    toggle.classList.add('active');
                    mobileNav.classList.add('active');
                    overlay.classList.add('active');
                    document.body.style.overflow = 'hidden';
                }
                
                function closeMenu() {
                    toggle.classList.remove('active');
                    mobileNav.classList.remove('active');
                    overlay.classList.remove('active');
                    document.body.style.overflow = '';
                }
                
                toggle.addEventListener('click', function(e) {
                    e.stopPropagation();
                    if (mobileNav.classList.contains('active')) {
                        closeMenu();
                    } else {
                        openMenu();
                    }
                });
                
                overlay.addEventListener('click', closeMenu);
                
                // Close menu when clicking nav links
                const navLinks = mobileNav.querySelectorAll('.nav-link');
                navLinks.forEach(function(link) {
                    link.addEventListener('click', function() {
                        closeMenu();
                    });
                });
                
                // Sync mobile and desktop theme toggles
                if (mobileThemeToggle && desktopThemeToggle) {
                    function syncThemeToggles() {
                        const isLight = document.documentElement.getAttribute('data-theme') === 'light';
                        mobileThemeToggle.checked = isLight;
                        desktopThemeToggle.checked = isLight;
                    }
                    
                    mobileThemeToggle.addEventListener('change', function() {
                        const theme = this.checked ? 'light' : 'dark';
                        document.documentElement.setAttribute('data-theme', theme);
                        try {
                            localStorage.setItem('theme', theme);
                        } catch(e) {}
                        desktopThemeToggle.checked = this.checked;
                        
                        // Update CodeMirror theme
                        if (typeof CodeMirror !== 'undefined') {
                            setTimeout(function() {
                                document.querySelectorAll('.CodeMirror').forEach(function(el) {
                                    try {
                                        const cm = el.CodeMirror;
                                        if (cm) {
                                            cm.setOption('theme', theme === 'light' ? 'default' : 'monokai');
                                        }
                                    } catch(e) {}
                                });
                            }, 50);
                        }
                    });
                    
                    desktopThemeToggle.addEventListener('change', function() {
                        mobileThemeToggle.checked = this.checked;
                    });
                    
                    // Initial sync
                    syncThemeToggles();
                    
                    // Sync on theme change
                    const observer = new MutationObserver(syncThemeToggles);
                    observer.observe(document.documentElement, {
                        attributes: true,
                        attributeFilter: ['data-theme']
                    });
                }
                
                // Close menu on escape key
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape' && mobileNav.classList.contains('active')) {
                        closeMenu();
                    }
                });
            }
            
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initMobileMenu);
            } else {
                initMobileMenu();
            }
        })();
    </script>
</head>
<body>
    <header>
        <div>
            <h1>LeetCode Clone</h1>
            <div class="header-controls">
                <div class="theme-switch-container">
                    <span class="theme-switch-label">Theme</span>
                    <label class="theme-switch" for="theme-toggle-switch" title="Toggle dark/light theme">
                        <input type="checkbox" id="theme-toggle-switch" aria-label="Toggle theme">
                        <span class="slider"></span>
                    </label>
                </div>
                <button class="mobile-menu-toggle" id="mobile-menu-toggle" aria-label="Toggle mobile menu">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
    </header>
    <div class="app-container">
        <aside class="sidebar">
            <nav class="sidebar-nav">
                <a href="/" class="nav-link">Problems</a>
                <a href="/algorithms" class="nav-link">Algorithms</a>
                <a href="/systems-design" class="nav-link">Systems Design</a>
                <a href="/golang" class="nav-link">Golang</a>
                <a href="/python" class="nav-link">Python</a>
                <a href="/kubernetes" class="nav-link">Kubernetes</a>
                <a href="/linux" class="nav-link">Linux</a>
                <a href="/machine-learning" class="nav-link">Machine Learning</a>
                <a href="/math" class="nav-link">Math</a>
                <a href="/networking" class="nav-link">Networking</a>
                <a href="/frontend" class="nav-link">Frontend</a>
                <a href="/devops" class="nav-link">DevOps</a>
                <a href="/software-architecture" class="nav-link">Software Architecture</a>
                <a href="/aws" class="nav-link">AWS</a>
                <a href="/azure" class="nav-link">Azure</a>
                <a href="/computer-architecture" class="nav-link">Computer Architecture</a>
            </nav>
        </aside>
        <main class="main-content">
            {{block "content" .}}{{end}}
        </main>
    </div>
    <div class="mobile-overlay" id="mobile-overlay"></div>
    <nav class="mobile-nav" id="mobile-nav">
        <div class="theme-switch-container">
            <span class="theme-switch-label">Theme</span>
            <label class="theme-switch" for="theme-toggle-switch-mobile" title="Toggle dark/light theme">
                <input type="checkbox" id="theme-toggle-switch-mobile" aria-label="Toggle theme">
                <span class="slider"></span>
            </label>
        </div>
        <a href="/" class="nav-link">Problems</a>
        <a href="/algorithms" class="nav-link">Algorithms</a>
        <a href="/systems-design" class="nav-link">Systems Design</a>
        <a href="/golang" class="nav-link">Golang</a>
        <a href="/python" class="nav-link">Python</a>
        <a href="/kubernetes" class="nav-link">Kubernetes</a>
        <a href="/linux" class="nav-link">Linux</a>
        <a href="/machine-learning" class="nav-link">Machine Learning</a>
        <a href="/math" class="nav-link">Math</a>
        <a href="/networking" class="nav-link">Networking</a>
        <a href="/frontend" class="nav-link">Frontend</a>
        <a href="/devops" class="nav-link">DevOps</a>
        <a href="/software-architecture" class="nav-link">Software Architecture</a>
        <a href="/aws" class="nav-link">AWS</a>
        <a href="/azure" class="nav-link">Azure</a>
        <a href="/computer-architecture" class="nav-link">Computer Architecture</a>
    </nav>
</body>
</html>
