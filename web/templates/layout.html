<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{block "title" .}}LeetCode Clone{{end}}</title>
    <script>
        // Apply theme immediately to prevent flash
        (function() {
            try {
                const savedTheme = localStorage.getItem('theme') || 'dark';
                document.documentElement.setAttribute('data-theme', savedTheme);
            } catch(e) {
                document.documentElement.setAttribute('data-theme', 'dark');
            }
        })();
    </script>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/monokai.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/go/go.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/python/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/yaml/yaml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/sql/sql.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/json/json.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/runmode/runmode.min.js"></script>
    <link rel="stylesheet" href="/static/style.css">
    <script>
        // Highlight code blocks on page load and after HTMX updates
        function highlightCode() {
            if (typeof CodeMirror !== 'undefined' && CodeMirror.runMode) {
                // Find all code blocks
                var codeBlocks = document.querySelectorAll('.lesson-code code, code[class*="language-"]');
                codeBlocks.forEach(function(block) {
                    if (!block.hasAttribute('data-highlighted')) {
                        var text = block.textContent;
                        var lang = 'python'; // default
                        
                        // Detect language from class
                        if (block.className) {
                            if (block.className.includes('language-go') || block.className.includes('language-golang')) {
                                lang = 'go';
                            } else if (block.className.includes('language-python')) {
                                lang = 'python';
                            } else if (block.className.includes('language-javascript') || block.className.includes('language-js')) {
                                lang = 'javascript';
                            } else if (block.className.includes('language-java')) {
                                lang = 'text/x-java';
                            } else if (block.className.includes('language-cpp') || block.className.includes('language-c++')) {
                                lang = 'text/x-c++src';
                            } else if (block.className.includes('language-c')) {
                                lang = 'text/x-csrc';
                            } else if (block.className.includes('language-sql')) {
                                lang = 'text/x-sql';
                            } else if (block.className.includes('language-bash') || block.className.includes('language-sh')) {
                                lang = 'text/x-sh';
                            } else if (block.className.includes('language-yaml')) {
                                lang = 'yaml';
                            } else if (block.className.includes('language-json')) {
                                lang = 'application/json';
                            } else {
                                // Try to detect from parent context or content
                                var parent = block.closest('.lesson-code');
                                if (parent) {
                                    // Check if we're in a specific course module
                                    var url = window.location.pathname;
                                    if (url.includes('/golang')) {
                                        lang = 'go';
                                    } else if (url.includes('/python')) {
                                        lang = 'python';
                                    } else if (url.includes('/kubernetes')) {
                                        lang = 'yaml'; // Default for Kubernetes (YAML manifests)
                                    } else if (url.includes('/algorithms')) {
                                        lang = 'python'; // Default for algorithms
                                    }
                                }
                            }
                        }
                        
                        block.textContent = '';
                        try {
                            CodeMirror.runMode(text, lang, block);
                            block.setAttribute('data-highlighted', 'true');
                        } catch (e) {
                            // If language not supported, just display as plain text
                            block.textContent = text;
                            block.setAttribute('data-highlighted', 'true');
                        }
                    }
                });
            }
        }
        document.addEventListener('DOMContentLoaded', highlightCode);
        if (document.body) {
            document.body.addEventListener('htmx:afterSwap', highlightCode);
        }
        // Also highlight when lessons are toggled
        window.highlightCode = highlightCode;

        // Theme toggle functionality
        (function() {
            'use strict';
            
            function applyTheme(theme) {
                const html = document.documentElement;
                html.setAttribute('data-theme', theme);
                try {
                    localStorage.setItem('theme', theme);
                } catch(e) {}
                
                const toggle = document.getElementById('theme-toggle-switch');
                if (toggle) {
                    toggle.checked = (theme === 'light');
                }
                
                // Update CodeMirror
                if (typeof CodeMirror !== 'undefined') {
                    setTimeout(function() {
                        document.querySelectorAll('.CodeMirror').forEach(function(el) {
                            try {
                                const cm = el.CodeMirror;
                                if (cm) {
                                    cm.setOption('theme', theme === 'light' ? 'default' : 'monokai');
                                }
                            } catch(e) {}
                        });
                    }, 50);
                }
            }
            
            function initTheme() {
                const toggle = document.getElementById('theme-toggle-switch');
                if (!toggle) {
                    setTimeout(initTheme, 50);
                    return;
                }
                
                const savedTheme = (function() {
                    try {
                        return localStorage.getItem('theme') || 'dark';
                    } catch(e) {
                        return 'dark';
                    }
                })();
                
                applyTheme(savedTheme);
                
                toggle.addEventListener('change', function() {
                    applyTheme(this.checked ? 'light' : 'dark');
                });
            }
            
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initTheme);
            } else {
                initTheme();
            }
        })();
    </script>
</head>
<body>
    <header>
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h1>LeetCode Clone</h1>
            <nav style="display: flex; gap: 10px; align-items: center;">
                <label class="theme-switch" for="theme-toggle-switch" title="Toggle dark/light theme">
                    <input type="checkbox" id="theme-toggle-switch" aria-label="Toggle theme">
                    <span class="slider"></span>
                </label>
                <a href="/" class="nav-link">Problems</a>
                <a href="/algorithms" class="nav-link">Algorithms</a>
                <a href="/systems-design" class="nav-link">Systems Design</a>
                <a href="/golang" class="nav-link">Golang</a>
                <a href="/python" class="nav-link">Python</a>
                <a href="/kubernetes" class="nav-link">Kubernetes</a>
                <a href="/linux" class="nav-link">Linux</a>
                <a href="/machine-learning" class="nav-link">Machine Learning</a>
                <a href="/networking" class="nav-link">Networking</a>
            </nav>
        </div>
    </header>
    <main>
        {{block "content" .}}{{end}}
    </main>
</body>
</html>
